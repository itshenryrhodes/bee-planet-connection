<!-- _layouts/default.html -->
<!doctype html>
<html lang="en">
<head>
  {% include head.html %}
</head>
<body>
  {% include header.html %}

  <main id="main" class="container">
    {{ content }}
  </main>

  <footer class="site-footer">
    <p>&copy; {{ "now" | date: "%Y" }} Bee Planet Connection</p>
  </footer>

  <script>
    // basic menu toggle (no framework)
    const btn = document.querySelector('.menu-toggle');
    const menu = document.getElementById('site-menu');
    if (btn && menu) {
      btn.addEventListener('click', () => {
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', (!expanded).toString());
        menu.classList.toggle('open');
      });
    }
  </script>

  <!-- Register Service Worker (force fresh fetch & clear logs) -->
  <script>
    (function(){
      if (!('serviceWorker' in navigator)) {
        console.warn('[BPC] SW not supported in this browser.');
        return;
      }
      // Force a fresh fetch of sw.js by adding a version query (prevents stale SW script)
      var swUrl = '{{ "/sw.js" | relative_url }}?v={{ site.time | date: "%Y%m%d%H%M%S" }}';

      window.addEventListener('load', function(){
        navigator.serviceWorker.register(swUrl, { scope: '/' })
          .then(function(reg){
            console.log('[BPC] SW registered:', reg.scope);
            // Optional: log when itâ€™s ready/active
            navigator.serviceWorker.ready.then(function(r){
              console.log('[BPC] SW ready:', r.active && r.active.state);
            });
          })
          .catch(function(err){
            console.error('[BPC] SW registration failed:', err);
          });
      });
    })();
  </script>
</body>
</html>
