<!-- _layouts/default.html -->
<!doctype html>
<html lang="en">
<head>
  {% include head.html %}
</head>
<body>
  {% include header.html %}

  <main id="main" class="container">
    {{ content }}
  </main>

  <footer class="site-footer">
    <p>&copy; {{ "now" | date: "%Y" }} Bee Planet Connection</p>
  </footer>

  <script>
    // Basic menu toggle (no framework)
    const btn = document.querySelector('.menu-toggle');
    const menu = document.getElementById('site-menu');
    if (btn && menu) {
      btn.addEventListener('click', () => {
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', (!expanded).toString());
        menu.classList.toggle('open');
      });
    }
  </script>

  <!-- Register Service Worker with detailed logs -->
  <script>
    (function(){
      if (!('serviceWorker' in navigator)) {
        console.warn('[BPC] Service Worker not supported in this browser.');
        return;
      }

      // Add a version query string to avoid stale SW caching
      var swUrl = '{{ "/sw.js" | relative_url }}?v={{ site.time | date: "%Y%m%d%H%M%S" }}';

      window.addEventListener('load', function(){
        navigator.serviceWorker.register(swUrl, { scope: '/' })
          .then(function(reg){
            console.log('[BPC] Service Worker registered with scope:', reg.scope);
            if (reg.installing) console.log('[BPC] SW state: installing');
            if (reg.waiting) console.log('[BPC] SW state: waiting');
            if (reg.active) console.log('[BPC] SW state: active');
          })
          .catch(function(err){
            console.error('[BPC] Service Worker registration failed:', err);
          });
      });
    })();
  </script>
</body>
</html>
