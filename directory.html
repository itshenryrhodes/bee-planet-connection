<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Apiculture Directory | Bee Planet Connection</title>
  <meta name="description" content="Browse and filter apiculture organisations, associations, and resources worldwide." />
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background: #faf7f1; color: #333; }
    header { background: #fff8e8; border-bottom: 1px solid #ddd; padding: 1rem; }
    h1 { margin: 0; }
    .filters { display: flex; flex-wrap: wrap; gap: 1rem; padding: 1rem; background: #fff; border-bottom: 1px solid #ddd; }
    .filters select { padding: 0.5rem; }
    .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; padding: 1rem; }
    .card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 1rem; }
    .card h2 { margin-top: 0; }
    footer { text-align: center; padding: 2rem; color: #666; font-size: 0.9rem; }
  </style>
</head>
<body>
  <header>
    <h1>Global Apiculture Directory</h1>
    <p>Browse organisations and resources worldwide</p>
  </header>

  <section class="filters">
    <select id="regionFilter"><option value="">All Regions</option></select>
    <select id="countryFilter"><option value="">All Countries</option></select>
    <select id="typeFilter"><option value="">All Types</option></select>
    <select id="scopeFilter"><option value="">All Scopes</option></select>
    <select id="topicFilter"><option value="">All Topics</option></select>
  </section>

  <main class="cards" id="cards"></main>

  <footer>
    Bee Planet Connection © 2025 — Illustrations by E.H. Shepard (Public Domain)
  </footer>

  <script>
    async function loadJSON(url) {
      const res = await fetch(url);
      return await res.json();
    }

    function createCard(item) {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <h2>${item.name}</h2>
        <p><strong>Region:</strong> ${item.region || ''}</p>
        <p><strong>Country:</strong> ${item.country || ''}</p>
        <p><strong>Type:</strong> ${item.type || ''}</p>
        <p><strong>Scope:</strong> ${item.scope || ''}</p>
        <p><strong>Topics:</strong> ${item.topics ? item.topics.join(', ') : ''}</p>
        <p><a href="${item.url}" target="_blank">Visit Website</a></p>
      `;
      return card;
    }

    function populateFilters(data, field, elementId) {
      const select = document.getElementById(elementId);
      const options = [...new Set(data.map(d => d[field]).flat().filter(Boolean))].sort();
      for (const opt of options) {
        const optionEl = document.createElement('option');
        optionEl.value = opt;
        optionEl.textContent = opt;
        select.appendChild(optionEl);
      }
    }

    function filterData(data) {
      const region = document.getElementById('regionFilter').value;
      const country = document.getElementById('countryFilter').value;
      const type = document.getElementById('typeFilter').value;
      const scope = document.getElementById('scopeFilter').value;
      const topic = document.getElementById('topicFilter').value;

      return data.filter(d =>
        (!region || d.region === region) &&
        (!country || d.country === country) &&
        (!type || d.type === type) &&
        (!scope || d.scope === scope) &&
        (!topic || (d.topics && d.topics.includes(topic)))
      );
    }

    async function init() {
      const data = await loadJSON('./data/directory.seed.json');

      populateFilters(data, 'region', 'regionFilter');
      populateFilters(data, 'country', 'countryFilter');
      populateFilters(data, 'type', 'typeFilter');
      populateFilters(data, 'scope', 'scopeFilter');
      populateFilters(data, 'topics', 'topicFilter');

      function render() {
        const cards = document.getElementById('cards');
        cards.innerHTML = '';
        const filtered = filterData(data);
        filtered.forEach(item => cards.appendChild(createCard(item)));
      }

      document.querySelectorAll('.filters select').forEach(sel => sel.addEventListener('change', render));
      render();
    }

    init();
  </script>
</body>
</html>
